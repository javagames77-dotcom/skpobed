<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü—Ä–æ—Ñ–∏–ª—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ ‚Äî InSkill Online</title>
<style>
:root{--p:#0066CC;--s:#FF9933;--d:#1a1a1a;--l:#f8f9fa;--b:#e0e0e0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:var(--l);color:var(--d)}
.header{background:#fff;border-bottom:3px solid var(--p);padding:1rem 2rem;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.header-content{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:700;color:var(--p);text-decoration:none}
.btn-back{padding:.5rem 1rem;background:var(--l);border:1px solid var(--b);border-radius:6px;cursor:pointer;text-decoration:none;color:var(--d);font-weight:500}
.container{max-width:1200px;margin:2rem auto;padding:0 2rem}
.profile-header{background:#fff;padding:2rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,.05);display:flex;gap:2rem;align-items:center}
.athlete-photo{width:150px;height:150px;border-radius:50%;object-fit:cover;border:4px solid var(--p)}
.athlete-info h1{font-size:2rem;color:var(--p);margin-bottom:.5rem}
.athlete-meta{display:flex;gap:1.5rem;color:#666;font-size:.9rem;flex-wrap:wrap}
.meta-item{display:flex;align-items:center;gap:.5rem}
.section{background:#fff;padding:2rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.section-title{font-size:1.5rem;color:var(--p);margin-bottom:1rem;padding-bottom:.5rem;border-bottom:2px solid var(--b)}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}
.info-item{padding:1rem;background:var(--l);border-radius:8px}
.info-label{font-size:.85rem;color:#666;text-transform:uppercase;font-weight:600;margin-bottom:.5rem}
.info-value{font-size:1.1rem;color:var(--d);font-weight:500}
.attendance-stats{display:flex;gap:2rem;flex-wrap:wrap}
.stat-card{flex:1;min-width:200px;padding:1.5rem;background:linear-gradient(135deg,var(--p),#0052a3);color:#fff;border-radius:12px;text-align:center}
.stat-value{font-size:3rem;font-weight:700;margin-bottom:.5rem}
.stat-label{font-size:1rem;opacity:.9}
.timeline{position:relative;padding-left:2rem}
.timeline:before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:var(--b)}
.timeline-item{position:relative;padding-bottom:1.5rem}
.timeline-dot{position:absolute;left:-2.25rem;top:4px;width:12px;height:12px;border-radius:50%;background:var(--p)}
.timeline-date{font-size:.85rem;color:#666;margin-bottom:.25rem}
.timeline-content{padding:.75rem;background:var(--l);border-radius:8px}
.btn-edit{padding:.75rem 1.5rem;background:var(--s);color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem}
.loading{text-align:center;padding:3rem;color:var(--p)}
@media (max-width:768px){
.container{padding:0 1rem}
.profile-header{flex-direction:column;text-align:center}
.athlete-meta{justify-content:center}
.info-grid{grid-template-columns:1fr}
.attendance-stats{flex-direction:column}
}
</style>
</head>
<body>

<header class="header">
<div class="header-content">
<a href="/" class="logo">
<span>InSkill<span style="color:var(--s)">.online</span></span>
</a>
<a href="/children-list.html" class="btn-back">‚Üê –ù–∞–∑–∞–¥</a>
</div>
</header>

<div class="container">
<div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</div>

<div id="profile" style="display:none">
<div class="profile-header">
<img id="athletePhoto" src="https://via.placeholder.com/150" class="athlete-photo" alt="">
<div class="athlete-info">
<h1 id="athleteName">‚Äî</h1>
<div class="athlete-meta">
<div class="meta-item">üìÖ <span id="athleteAge">‚Äî</span></div>
<div class="meta-item">üë• <span id="athleteGroup">‚Äî</span></div>
<div class="meta-item">üìç <span id="athleteClub">‚Äî</span></div>
</div>
<button class="btn-edit" onclick="editAthlete()" style="margin-top:1rem">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
</div>
</div>

<div class="section">
<h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h2>
<div class="attendance-stats">
<div class="stat-card">
<div class="stat-value" id="statTotal">‚Äî</div>
<div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
</div>
<div class="stat-card" style="background:linear-gradient(135deg,#28a745,#1e7e34)">
<div class="stat-value" id="statPresent">‚Äî</div>
<div class="stat-label">–ü–æ—Å–µ—â–µ–Ω–æ</div>
</div>
<div class="stat-card" style="background:linear-gradient(135deg,var(--s),#ff8800)">
<div class="stat-value" id="statPercent">‚Äî%</div>
<div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç</div>
</div>
</div>
</div>

<div class="section">
<h2 class="section-title">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
<div class="info-grid">
<div class="info-item">
<div class="info-label">–ò–º—è</div>
<div class="info-value" id="infoFirstName">‚Äî</div>
</div>
<div class="info-item">
<div class="info-label">–§–∞–º–∏–ª–∏—è</div>
<div class="info-value" id="infoLastName">‚Äî</div>
</div>
<div class="info-item">
<div class="info-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
<div class="info-value" id="infoBirthDate">‚Äî</div>
</div>
<div class="info-item">
<div class="info-label">–ì—Ä—É–ø–ø–∞</div>
<div class="info-value" id="infoGroup">‚Äî</div>
</div>
<div class="info-item">
<div class="info-label">Face Token</div>
<div class="info-value" id="infoFaceToken" style="font-size:.8rem;word-break:break-all">‚Äî</div>
</div>
</div>
</div>

<div class="section">
<h2 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π</h2>
<div class="timeline" id="timeline">
<div class="timeline-item">
<div class="timeline-dot"></div>
<div class="timeline-date">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>
</div>
</div>
</div>
</div>

<script>
const API='https://primary-production-4b93e.up.railway.app/webhook/api';
let token=localStorage.getItem('token');
let athleteId=new URLSearchParams(window.location.search).get('id');
let athlete=null;

if(!token||!athleteId){window.location.href='/';throw new Error('No auth');}

async function loadProfile(){
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'children',action:'get',data:{id:parseInt(athleteId)}})});
let d=await r.json();
athlete=(d.merged&&d.merged[0])||(Array.isArray(d)?d[0]:d);
if(!athlete||!athlete.id){alert('–°–ø–æ—Ä—Ç—Å–º–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');window.location.href='/children-list.html';return}
renderProfile();
loadAttendance();
}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')}
}

function renderProfile(){
document.getElementById('loading').style.display='none';
document.getElementById('profile').style.display='block';
document.getElementById('athletePhoto').src=athlete.photo_url||'https://via.placeholder.com/150';
document.getElementById('athleteName').textContent=`${athlete.first_name} ${athlete.last_name}`;
if(athlete.birth_date){
const age=new Date().getFullYear()-new Date(athlete.birth_date).getFullYear();
document.getElementById('athleteAge').textContent=`${age} –ª–µ—Ç`;
document.getElementById('infoBirthDate').textContent=new Date(athlete.birth_date).toLocaleDateString('ru-RU');
}
document.getElementById('athleteGroup').textContent=athlete.group_name||'–ë–µ–∑ –≥—Ä—É–ø–ø—ã';
document.getElementById('athleteClub').textContent=athlete.club_name||'‚Äî';
document.getElementById('infoFirstName').textContent=athlete.first_name;
document.getElementById('infoLastName').textContent=athlete.last_name;
document.getElementById('infoGroup').textContent=athlete.group_name||'–ë–µ–∑ –≥—Ä—É–ø–ø—ã';
document.getElementById('infoFaceToken').textContent=athlete.face_token||'–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
}

async function loadAttendance(){
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'attendance',action:'list',data:{child_id:parseInt(athleteId)}})});
let d=await r.json();
const records=(d.merged||d||[]).filter(x=>x.child_id==athleteId);
const total=records.length;
const present=records.filter(x=>x.status==='present').length;
const percent=total>0?Math.round((present/total)*100):0;
document.getElementById('statTotal').textContent=total;
document.getElementById('statPresent').textContent=present;
document.getElementById('statPercent').textContent=percent+'%';
renderTimeline(records);
}catch(e){console.error(e)}
}

function renderTimeline(records){
const t=document.getElementById('timeline');
t.innerHTML='';
if(records.length===0){
t.innerHTML='<div class="timeline-item"><div class="timeline-dot"></div><div class="timeline-content">–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π –ø–æ–∫–∞ –ø—É—Å—Ç–∞</div></div>';
return;
}
records.sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,10).forEach(r=>{
const item=document.createElement('div');
item.className='timeline-item';
const status=r.status==='present'?'‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª':'‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª';
const confidence=r.confidence?` (${r.confidence}%)` :'';
item.innerHTML=`<div class="timeline-dot"></div><div class="timeline-date">${new Date(r.date).toLocaleDateString('ru-RU')}</div><div class="timeline-content">${status}${confidence}</div>`;
t.appendChild(item);
});
}

function editAthlete(){
window.location.href=`/children-list.html?edit=${athleteId}`;
}

loadProfile();
</script>
</body>
</html>