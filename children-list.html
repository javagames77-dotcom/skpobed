<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Webhook Table</title>
<style>
  body { font-family: sans-serif; padding: 1rem; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
  th { background: #eee; }
</style>
</head>
<body>
<h1>Список групп</h1>
<table id="table">
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>faceset_token</th>
      <th>created_at</th>
      <th>club_name</th>
      <th>trainer_name</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<script>
const API='https://primary-production-4b93e.up.railway.app/webhook-test/api';
let token = localStorage.getItem('token');

async function loadData() {
  try {
    const res = await fetch(API, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({token, resource:'groups', action:'list'})
    });
    const data = await res.json();

    // Предполагаем, что n8n прислал массив в поле merged
    const list = data.merged || [];

    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';
    list.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.id}</td>
        <td>${item.name}</td>
        <td>${item.faceset_token ?? '-'}</td>
        <td>${item.created_at}</td>
        <td>${item.club_name ?? '-'}</td>
        <td>${item.trainer_name ?? '-'}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch(e) {
    document.getElementById('tbody').innerHTML = '<tr><td colspan="6">Ошибка загрузки</td></tr>';
    console.error(e);
  }
}

loadData();
</script>
</body>
</html>
