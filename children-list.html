<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>InSkill Online</title>
<style>
:root{--p:#0066CC;--s:#FF9933;--d:#1a1a1a;--l:#f8f9fa;--b:#e0e0e0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:var(--l);color:var(--d)}
.header{background:#fff;border-bottom:3px solid var(--p);padding:1rem 2rem;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.header-content{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:700;color:var(--p);text-decoration:none}
.logo-icon{width:40px;height:40px;background:var(--p);border-radius:8px;display:flex;align-items:center;justify-content:center}
.logo-bars{display:flex;gap:3px;align-items:flex-end}
.logo-bar{width:6px;background:#fff;border-radius:2px}
.logo-bar:nth-child(1){height:12px}
.logo-bar:nth-child(2){height:18px;background:var(--s)}
.logo-bar:nth-child(3){height:24px;background:var(--s)}
.btn-logout{padding:.5rem 1rem;background:#fff;border:1px solid var(--b);border-radius:6px;cursor:pointer;font-size:.9rem}
.container{max-width:1400px;margin:2rem auto;padding:0 2rem}
.tabs{display:flex;gap:.5rem;margin-bottom:1.5rem;border-bottom:2px solid var(--b)}
.tab{padding:1rem 2rem;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:1rem;font-weight:600;color:#666}
.tab.active{color:var(--p);border-bottom-color:var(--p)}
.tab-content{display:none}
.tab-content.active{display:block}
.page-header{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,.05);display:flex;justify-content:space-between;align-items:center}
.page-title{font-size:1.75rem;font-weight:700;color:var(--p)}
.filters{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,.05);display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-end}
.filter-group{flex:1;min-width:200px}
.filter-label{display:block;margin-bottom:.5rem;font-size:.85rem;font-weight:600;color:#555;text-transform:uppercase}
.filter-input,.filter-select{width:100%;padding:.75rem;border:2px solid var(--b);border-radius:8px;font-size:1rem}
.btn-add{padding:.75rem 1.5rem;background:var(--s);color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem;display:flex;align-items:center;gap:.5rem;white-space:nowrap}
.table-container{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.05);overflow:hidden}
.table{width:100%;border-collapse:collapse}
.table thead{background:linear-gradient(135deg,var(--p),#0052a3);color:#fff}
.table th{padding:1rem;text-align:left;font-weight:600;text-transform:uppercase;font-size:.85rem}
.table td{padding:1rem;border-bottom:1px solid var(--b)}
.child-photo{width:50px;height:50px;border-radius:50%;object-fit:cover;border:2px solid var(--b)}
.group-badge{display:inline-block;padding:.35rem .75rem;background:#e3f2fd;color:var(--p);border-radius:20px;font-size:.85rem;font-weight:500}
.table-actions{display:flex;gap:.5rem}
.btn-icon{width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.btn-edit{background:#e3f2fd;color:var(--p)}
.btn-delete{background:#ffebee;color:#dc3545}
.loading{text-align:center;padding:3rem;color:var(--p)}
.empty-state{text-align:center;padding:4rem 2rem;color:#999}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center;padding:1rem}
.modal.active{display:flex}
.modal-content{background:#fff;border-radius:16px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.modal-header{padding:1.5rem;border-bottom:2px solid var(--b);display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:1.5rem;font-weight:700;color:var(--p)}
.modal-close{width:32px;height:32px;border:none;background:var(--l);border-radius:50%;cursor:pointer;font-size:1.2rem}
.modal-body{padding:1.5rem}
.form-group{margin-bottom:1.25rem}
.form-label{display:block;margin-bottom:.5rem;font-weight:600;color:#555;font-size:.9rem}
.form-input,.form-select{width:100%;padding:.75rem;border:2px solid var(--b);border-radius:8px;font-size:1rem}
.date-inputs{display:flex;gap:.75rem}
.date-inputs .form-group{flex:1;margin-bottom:0}
.modal-footer{padding:1.5rem;border-top:2px solid var(--b);display:flex;gap:1rem;justify-content:flex-end}
.btn{padding:.75rem 1.5rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem}
.btn-cancel{background:var(--l);color:var(--d)}
.btn-save{background:var(--s);color:#fff}
@media (max-width:768px){
.container{padding:0 1rem}
.tabs{overflow-x:auto}
.page-header{flex-direction:column;gap:1rem;align-items:flex-start}
.filters{flex-direction:column}
.filter-group{width:100%}
.btn-add{width:100%;justify-content:center}
.table thead{display:none}
.table,.table tbody,.table tr,.table td{display:block}
.table tr{background:#fff;margin-bottom:1rem;border-radius:12px;padding:1rem}
.table td{border:none;padding:.5rem 0;display:flex;justify-content:space-between}
.table td:before{content:attr(data-label);font-weight:600;color:#666;font-size:.85rem}
.table td:first-child{justify-content:center;padding-bottom:1rem;border-bottom:1px solid var(--b)}
.table td:first-child:before{display:none}
.date-inputs{flex-direction:column}
}
</style>
</head>
<body>

<header class="header">
<div class="header-content">
<a href="/" class="logo">
<div class="logo-icon"><div class="logo-bars"><div class="logo-bar"></div><div class="logo-bar"></div><div class="logo-bar"></div></div></div>
<span>InSkill<span style="color:var(--s)">.online</span></span>
</a>
<div style="display:flex;align-items:center;gap:1rem">
<span id="userName">‚Äî</span>
<button class="btn-logout" onclick="logout()">–í—ã—Ö–æ–¥</button>
</div>
</div>
</header>

<div class="container">
<div class="tabs">
<button class="tab active" onclick="switchTab('children')">üë∂ –°–ø–æ—Ä—Ç—Å–º–µ–Ω—ã</button>
<button class="tab" onclick="switchTab('groups')">üë• –ì—Ä—É–ø–ø—ã</button>
</div>

<div class="tab-content active" id="tab-children">
<div class="page-header">
<h1 class="page-title">–°–ø–æ—Ä—Ç—Å–º–µ–Ω—ã</h1>
<button class="btn-add" onclick="addChild()"><span>‚ûï</span><span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
</div>
<div class="filters">
<div class="filter-group">
<label class="filter-label">–ü–æ–∏—Å–∫</label>
<input type="text" class="filter-input" id="searchInput" placeholder="–ò–º—è...">
</div>
<div class="filter-group">
<label class="filter-label">–ì—Ä—É–ø–ø–∞</label>
<select class="filter-select" id="groupFilter"><option value="">–í—Å–µ</option></select>
</div>
</div>
<div class="table-container">
<div id="loadingChildren" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<div id="emptyChildren" class="empty-state" style="display:none"><h3>–ù–µ—Ç —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</h3></div>
<table class="table" id="childrenTable" style="display:none">
<thead><tr><th>–§–æ—Ç–æ</th><th>–§–ò–û</th><th>–ì—Ä—É–ø–ø–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
<tbody id="childrenTableBody"></tbody>
</table>
</div>
</div>

<div class="tab-content" id="tab-groups">
<div class="page-header">
<h1 class="page-title">–ì—Ä—É–ø–ø—ã</h1>
<button class="btn-add" onclick="addGroup()"><span>‚ûï</span><span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
</div>
<div class="table-container">
<div id="loadingGroups" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<div id="emptyGroups" class="empty-state" style="display:none"><h3>–ù–µ—Ç –≥—Ä—É–ø–ø</h3></div>
<table class="table" id="groupsTable" style="display:none">
<thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
<tbody id="groupsTableBody"></tbody>
</table>
</div>
</div>
</div>

<div class="modal" id="childModal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="childModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞</h2>
<button class="modal-close" onclick="closeChildModal()">‚úï</button>
</div>
<div class="modal-body">
<form id="childForm" onsubmit="saveChild(event)">
<input type="hidden" id="childId">
<div class="form-group">
<label class="form-label">–ò–º—è *</label>
<input type="text" class="form-input" id="childFirstName" required>
</div>
<div class="form-group">
<label class="form-label">–§–∞–º–∏–ª–∏—è *</label>
<input type="text" class="form-input" id="childLastName" required>
</div>
<div class="form-group">
<label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
<div class="date-inputs">
<div class="form-group"><select class="form-select" id="childBirthDay"><option value="">–î–µ–Ω—å</option></select></div>
<div class="form-group"><select class="form-select" id="childBirthMonth"><option value="">–ú–µ—Å—è—Ü</option></select></div>
<div class="form-group"><select class="form-select" id="childBirthYear"><option value="">–ì–æ–¥</option></select></div>
</div>
</div>
<div class="form-group">
<label class="form-label">–ì—Ä—É–ø–ø–∞ *</label>
<select class="form-select" id="childGroupId" required><option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option></select>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-cancel" onclick="closeChildModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn btn-save" onclick="document.getElementById('childForm').requestSubmit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<div class="modal" id="groupModal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="groupModalTitle">–î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</h2>
<button class="modal-close" onclick="closeGroupModal()">‚úï</button>
</div>
<div class="modal-body">
<form id="groupForm" onsubmit="saveGroup(event)">
<input type="hidden" id="groupId">
<div class="form-group">
<label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
<input type="text" class="form-input" id="groupName" required>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-cancel" onclick="closeGroupModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn btn-save" onclick="document.getElementById('groupForm').requestSubmit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<script>
const API='https://primary-production-4b93e.up.railway.app/webhook/api';
let token=localStorage.getItem('token');
let children=[],groups=[],filtered=[];
if(!token)window.location.href='/';

function loadUserInfo(){
const u=JSON.parse(localStorage.getItem('user')||'{}');
document.getElementById('userName').textContent=u.first_name?`${u.first_name} ${u.last_name||''}`.trim():u.email||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
}

function switchTab(t){
document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
event.target.classList.add('active');
document.getElementById(`tab-${t}`).classList.add('active');
if(t==='groups'&&groups.length===0)loadGroups();
}

function initDateDropdowns(){
const d=document.getElementById('childBirthDay'),m=document.getElementById('childBirthMonth'),y=document.getElementById('childBirthYear');
for(let i=1;i<=31;i++){const o=document.createElement('option');o.value=i;o.textContent=i;d.appendChild(o)}
['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'].forEach((n,i)=>{const o=document.createElement('option');o.value=i+1;o.textContent=n;m.appendChild(o)});
const cy=new Date().getFullYear();
for(let i=cy;i>=cy-20;i--){const o=document.createElement('option');o.value=i;o.textContent=i;y.appendChild(o)}
}

async function loadGroups(){
try{
document.getElementById('loadingGroups').style.display='block';
document.getElementById('emptyGroups').style.display='none';
document.getElementById('groupsTable').style.display='none';
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'groups',action:'list'})});
let d=await r.json();
groups=d.merged||d||[];
document.getElementById('loadingGroups').style.display='none';
if(groups.length===0)document.getElementById('emptyGroups').style.display='block';
else{document.getElementById('groupsTable').style.display='table';renderGroupsTable()}
updateGroupFilter();
}catch(e){console.error(e);document.getElementById('loadingGroups').textContent='–û—à–∏–±–∫–∞'}
}

function renderGroupsTable(){
const t=document.getElementById('groupsTableBody');
t.innerHTML='';
groups.forEach(g=>{
const r=document.createElement('tr');
r.innerHTML=`<td data-label="–ù–∞–∑–≤–∞–Ω–∏–µ">${g.name}</td><td data-label="–î–µ–π—Å—Ç–≤–∏—è"><div class="table-actions"><button class="btn-icon btn-edit" onclick="editGroup(${g.id})">‚úèÔ∏è</button><button class="btn-icon btn-delete" onclick="deleteGroup(${g.id})">üóëÔ∏è</button></div></td>`;
t.appendChild(r);
});
}

function updateGroupFilter(){
const s=document.getElementById('groupFilter'),c=document.getElementById('childGroupId');
s.innerHTML='<option value="">–í—Å–µ</option>';
c.innerHTML='<option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>';
groups.forEach(g=>{
const o1=document.createElement('option');o1.value=g.id;o1.textContent=g.name;s.appendChild(o1);
const o2=document.createElement('option');o2.value=g.id;o2.textContent=g.name;c.appendChild(o2);
});
}

async function loadChildren(){
try{
document.getElementById('loadingChildren').style.display='block';
document.getElementById('emptyChildren').style.display='none';
document.getElementById('childrenTable').style.display='none';
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'children',action:'list'})});
let d=await r.json();
children=d.merged||d||[];
filtered=children;
document.getElementById('loadingChildren').style.display='none';
if(children.length===0)document.getElementById('emptyChildren').style.display='block';
else{document.getElementById('childrenTable').style.display='table';renderChildrenTable()}
}catch(e){console.error(e);document.getElementById('loadingChildren').textContent='–û—à–∏–±–∫–∞'}
}

function renderChildrenTable(){
const t=document.getElementById('childrenTableBody');
t.innerHTML='';
filtered.forEach(c=>{
const r=document.createElement('tr');
r.innerHTML=`<td data-label="–§–æ—Ç–æ"><img src="${c.photo_url||'https://via.placeholder.com/50'}" class="child-photo"></td><td data-label="–§–ò–û"><a href="/athlete-profile.html?id=${c.id}" style="color:var(--p);text-decoration:none;font-weight:600">${c.first_name} ${c.last_name}</a></td><td data-label="–ì—Ä—É–ø–ø–∞"><span class="group-badge">${c.group_name||'–ë–µ–∑ –≥—Ä—É–ø–ø—ã'}</span></td><td data-label="–î–µ–π—Å—Ç–≤–∏—è"><div class="table-actions"><button class="btn-icon btn-edit" onclick="editChild(${c.id})">‚úèÔ∏è</button><button class="btn-icon btn-delete" onclick="deleteChild(${c.id})">üóëÔ∏è</button></div></td>`;
t.appendChild(r);
});
}

document.getElementById('searchInput').addEventListener('input',filterChildren);
document.getElementById('groupFilter').addEventListener('change',filterChildren);

function filterChildren(){
const s=document.getElementById('searchInput').value.toLowerCase(),g=document.getElementById('groupFilter').value;
filtered=children.filter(c=>{
const n=(c.first_name+' '+c.last_name).toLowerCase().includes(s);
const gr=!g||c.group_id==g;
return n&&gr;
});
renderChildrenTable();
}

function addChild(){
document.getElementById('childModalTitle').textContent='–î–æ–±–∞–≤–∏—Ç—å';
document.getElementById('childId').value='';
document.getElementById('childFirstName').value='';
document.getElementById('childLastName').value='';
document.getElementById('childBirthDay').value='';
document.getElementById('childBirthMonth').value='';
document.getElementById('childBirthYear').value='';
document.getElementById('childGroupId').value='';
openChildModal();
}

function editChild(id){
const c=children.find(x=>x.id===id);
if(!c)return;
document.getElementById('childModalTitle').textContent='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
document.getElementById('childId').value=c.id;
document.getElementById('childFirstName').value=c.first_name;
document.getElementById('childLastName').value=c.last_name;
if(c.birth_date){
const d=new Date(c.birth_date);
document.getElementById('childBirthDay').value=d.getDate();
document.getElementById('childBirthMonth').value=d.getMonth()+1;
document.getElementById('childBirthYear').value=d.getFullYear();
}
document.getElementById('childGroupId').value=c.group_id||'';
openChildModal();
}

async function saveChild(e){
e.preventDefault();
const id=document.getElementById('childId').value,fn=document.getElementById('childFirstName').value.trim(),ln=document.getElementById('childLastName').value.trim(),d=document.getElementById('childBirthDay').value,m=document.getElementById('childBirthMonth').value,y=document.getElementById('childBirthYear').value,g=document.getElementById('childGroupId').value;
if(!fn||!ln){alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');return}
if(!g){alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É');return}
const data={first_name:fn,last_name:ln,group_id:parseInt(g)};
if(d&&m&&y)data.birth_date=`${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
try{
const a=id?'update':'create';
if(id)data.id=parseInt(id);
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'children',action:a,data})});
let res=await r.json();
if(!res){alert('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç');return}
const result=(res.merged&&res.merged[0])||(Array.isArray(res)?res[0]:res);
if(result&&result.id){
closeChildModal();
alert(id?'–û–±–Ω–æ–≤–ª–µ–Ω–æ!':'–î–æ–±–∞–≤–ª–µ–Ω–æ!');
await loadChildren();
}else{
alert('–û—à–∏–±–∫–∞: '+(result?.error||JSON.stringify(res)));
}
}catch(err){
console.error(err);
alert('–û—à–∏–±–∫–∞: '+err.message);
}
}

async function deleteChild(id){
if(!confirm('–£–¥–∞–ª–∏—Ç—å?'))return;
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'children',action:'delete',data:{id}})});
let d=await r.json();
const result=Array.isArray(d)?d[0]:d;
if(result&&result.success){
alert('–£–¥–∞–ª–µ–Ω–æ');
await loadChildren();
}
}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞')}
}

function openChildModal(){
document.getElementById('childModal').classList.add('active');
document.body.style.overflow='hidden';
}

function closeChildModal(){
document.getElementById('childModal').classList.remove('active');
document.body.style.overflow='';
}

function addGroup(){
document.getElementById('groupModalTitle').textContent='–î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É';
document.getElementById('groupId').value='';
document.getElementById('groupName').value='';
openGroupModal();
}

function editGroup(id){
const g=groups.find(x=>x.id===id);
if(!g)return;
document.getElementById('groupModalTitle').textContent='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
document.getElementById('groupId').value=g.id;
document.getElementById('groupName').value=g.name;
openGroupModal();
}

async function saveGroup(e){
e.preventDefault();
const id=document.getElementById('groupId').value,n=document.getElementById('groupName').value.trim();
if(!n){alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');return}
const data={name:n};
try{
const a=id?'update':'create';
if(id)data.id=parseInt(id);
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'groups',action:a,data})});
let res=await r.json();
if(!res){alert('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç');return}
const result=(res.merged&&res.merged[0])||(Array.isArray(res)?res[0]:res);
if(result&&result.id){
closeGroupModal();
alert(id?'–û–±–Ω–æ–≤–ª–µ–Ω–æ!':'–°–æ–∑–¥–∞–Ω–æ!');
await loadGroups();
await loadChildren();
}else{
alert('–û—à–∏–±–∫–∞: '+(result?.error||JSON.stringify(res)));
}
}catch(err){
console.error(err);
alert('–û—à–∏–±–∫–∞: '+err.message);
}
}

async function deleteGroup(id){
const g=groups.find(x=>x.id===id);
if(!g)return;
const childrenInGroup=children.filter(c=>c.group_id===id);
if(childrenInGroup.length>0){
if(!confirm(`–í –≥—Ä—É–ø–ø–µ "${g.name}" –µ—Å—Ç—å ${childrenInGroup.length} —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤. –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É –∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏—Ö –≤ "–ë–µ–∑ –≥—Ä—É–ø–ø—ã"?`))return;
}else{
if(!confirm('–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É?'))return;
}
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'groups',action:'delete',data:{id}})});
let d=await r.json();
const result=(d.merged&&d.merged[0])||(Array.isArray(d)?d[0]:d);
if(result&&result.success){
alert('–ì—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞');
await loadGroups();
await loadChildren();
}
}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞')}
}

function openGroupModal(){
document.getElementById('groupModal').classList.add('active');
document.body.style.overflow='hidden';
}

function closeGroupModal(){
document.getElementById('groupModal').classList.remove('active');
document.body.style.overflow='';
}

function logout(){
localStorage.removeItem('token');
localStorage.removeItem('user');
window.location.href='/';
}

loadUserInfo();
initDateDropdowns();
loadGroups().then(()=>loadChildren());
</script>
</body>
</html>
