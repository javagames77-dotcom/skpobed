<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Webhook Groups Debug</title>
<style>
body{font-family:sans-serif;padding:2rem;background:#f8f9fa;color:#333}
h1{color:#0066CC}
pre{background:white;padding:1rem;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,0.1);overflow-x:auto}
ul{list-style:none;padding:0}
li{background:white;margin:0.5rem 0;padding:0.75rem 1rem;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
</style>
</head>
<body>

<h1>Сырой ответ</h1>
<pre id="raw">Загрузка...</pre>

<h1>Список имён</h1>
<ul id="names"><li>Загрузка...</li></ul>

<script>
const API = 'https://primary-production-4b93e.up.railway.app/webhook-test/api';
let token = localStorage.getItem('token');

async function loadWebhook() {
  const pre = document.getElementById('raw');
  const ul = document.getElementById('names');

  if(!token){
    pre.textContent = 'Нет токена!';
    ul.innerHTML = '<li>Нет токена!</li>';
    return;
  }

  try {
    const res = await fetch(API, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({token, resource:'groups', action:'list'})
    });

    const data = await res.json();

    // показать сырой ответ
    pre.textContent = JSON.stringify(data, null, 2);

    // вывести список имён
    ul.innerHTML = '';
    if(Array.isArray(data)){
      data.forEach(g => ul.appendChild(createLi(g.name)));
    } else if(data && typeof data === 'object'){
      // если объект — проверим ключи и массив внутри
      if(Array.isArray(data.data)) data.data.forEach(g => ul.appendChild(createLi(g.name)));
      else ul.appendChild(createLi(JSON.stringify(data)));
    } else {
      ul.appendChild(createLi('Пустой ответ'));
    }

  } catch(e){
    pre.textContent = 'Ошибка: ' + e;
    ul.innerHTML = '<li>Ошибка</li>';
  }
}

function createLi(text){
  const li = document.createElement('li');
  li.textContent = text;
  return li;
}

loadWebhook();
</script>
</body>
</html>
