<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>InSkill Online - –î–∏—Ä–µ–∫—Ç–æ—Ä</title>
<style>
:root{--p:#0066CC;--s:#FF9933;--d:#1a1a1a;--l:#f8f9fa;--b:#e0e0e0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:var(--l);color:var(--d)}
.header{background:#fff;border-bottom:3px solid var(--p);padding:1rem 2rem;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.header-content{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:700;color:var(--p);text-decoration:none}
.btn-logout{padding:.5rem 1rem;background:#fff;border:1px solid var(--b);border-radius:6px;cursor:pointer}
.lang-switcher{margin-right:1rem}
.lang-switcher select{padding:.5rem;border-radius:6px;border:1px solid var(--b)}
.container{max-width:1400px;margin:2rem auto;padding:0 2rem}
.tabs{display:flex;gap:.5rem;margin-bottom:1.5rem;border-bottom:2px solid var(--b)}
.tab{padding:1rem 2rem;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:1rem;font-weight:600;color:#666}
.tab.active{color:var(--p);border-bottom-color:var(--p)}
.tab-content{display:none}
.tab-content.active{display:block}
.page-header{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,.05);display:flex;justify-content:space-between;align-items:center}
.page-title{font-size:1.75rem;font-weight:700;color:var(--p)}
.btn-add{padding:.75rem 1.5rem;background:var(--s);color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem}
.table-container{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.05);overflow:hidden}
.table{width:100%;border-collapse:collapse}
.table thead{background:linear-gradient(135deg,var(--p),#0052a3);color:#fff}
.table th{padding:1rem;text-align:left;font-weight:600;text-transform:uppercase;font-size:.85rem}
.table td{padding:1rem;border-bottom:1px solid var(--b)}
.table-actions{display:flex;gap:.5rem}
.btn-icon{width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;font-size:1.1rem}
.btn-edit{background:#e3f2fd;color:var(--p)}
.btn-delete{background:#ffebee;color:#dc3545}
.loading{text-align:center;padding:3rem;color:var(--p)}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:#fff;border-radius:16px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto}
.modal-header{padding:1.5rem;border-bottom:2px solid var(--b);display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:1.5rem;font-weight:700;color:var(--p)}
.modal-close{width:32px;height:32px;border:none;background:var(--l);border-radius:50%;cursor:pointer;font-size:1.2rem}
.modal-body{padding:1.5rem}
.form-group{margin-bottom:1.25rem}
.form-label{display:block;margin-bottom:.5rem;font-weight:600;color:#555;font-size:.9rem}
.form-input,.form-select{width:100%;padding:.75rem;border:2px solid var(--b);border-radius:8px;font-size:1rem}
.modal-footer{padding:1.5rem;border-top:2px solid var(--b);display:flex;gap:1rem;justify-content:flex-end}
.btn{padding:.75rem 1.5rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem}
.btn-cancel{background:var(--l);color:var(--d)}
.btn-save{background:var(--s);color:#fff}
.schedule-editor{border:2px solid var(--b);border-radius:8px;padding:1rem}
.schedule-day{margin-bottom:1rem;padding:1rem;background:var(--l);border-radius:6px}
.schedule-day-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
.schedule-time{display:flex;gap:1rem}
.schedule-time input{flex:1;padding:.5rem;border:1px solid var(--b);border-radius:4px}
</style>
</head>
<body>

<header class="header">
<div class="header-content">
<a href="/" class="logo"><span>InSkill</span><span style="color:var(--s)">.online</span></a>
<div style="display:flex;align-items:center;gap:1rem">
<div class="lang-switcher">
<select id="langSelect" onchange="setLang(this.value)">
<option value="ru">üá∑üá∫</option>
<option value="uk">üá∫üá¶</option>
<option value="en">üá¨üáß</option>
</select>
</div>
<span id="userName">‚Äî</span>
<button class="btn-logout" onclick="logout()" id="btnLogout">–í—ã—Ö–æ–¥</button>
</div>
</div>
</header>

<div class="container">
<div class="tabs">
<button class="tab active" onclick="switchTab('clubs')" id="tabClubs">üè¢ –ö–ª—É–±—ã</button>
<button class="tab" onclick="switchTab('groups')" id="tabGroups">üë• –ì—Ä—É–ø–ø—ã</button>
<button class="tab" onclick="switchTab('trainers')" id="tabTrainers">üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä—ã</button>
</div>

<!-- CLUBS TAB -->
<div class="tab-content active" id="tab-clubs">
<div class="page-header">
<h1 class="page-title" id="titleClubs">–ö–ª—É–±—ã</h1>
<button class="btn-add" onclick="addClub()" id="btnAddClub">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
</div>
<div class="table-container">
<div id="loadingClubs" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<table class="table" id="clubsTable" style="display:none">
<thead><tr><th id="thClubName">–ù–∞–∑–≤–∞–Ω–∏–µ</th><th id="thClubAddress">–ê–¥—Ä–µ—Å</th><th id="thClubGroups">–ì—Ä—É–ø–ø</th><th id="thActions">–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
<tbody id="clubsTableBody"></tbody>
</table>
</div>
</div>

<!-- GROUPS TAB -->
<div class="tab-content" id="tab-groups">
<div class="page-header">
<h1 class="page-title" id="titleGroups">–ì—Ä—É–ø–ø—ã</h1>
<button class="btn-add" onclick="addGroup()" id="btnAddGroup">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
</div>
<div class="table-container">
<div id="loadingGroups" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<table class="table" id="groupsTable" style="display:none">
<thead><tr><th id="thGroupName">–ù–∞–∑–≤–∞–Ω–∏–µ</th><th id="thGroupClub">–ö–ª—É–±</th><th id="thGroupChildren">–î–µ—Ç–µ–π</th><th id="thGroupTrainers">–¢—Ä–µ–Ω–µ—Ä–æ–≤</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
<tbody id="groupsTableBody"></tbody>
</table>
</div>
</div>

<!-- TRAINERS TAB -->
<div class="tab-content" id="tab-trainers">
<div class="page-header">
<h1 class="page-title" id="titleTrainers">–¢—Ä–µ–Ω–µ—Ä—ã</h1>
<button class="btn-add" onclick="addTrainer()" id="btnAddTrainer">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
</div>
<div class="table-container">
<div id="loadingTrainers" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<table class="table" id="trainersTable" style="display:none">
<thead><tr><th id="thTrainerName">–§–ò–û</th><th id="thTrainerEmail">Email</th><th id="thTrainerGroups">–ì—Ä—É–ø–ø</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
<tbody id="trainersTableBody"></tbody>
</table>
</div>
</div>

</div>

<!-- CLUB MODAL -->
<div class="modal" id="clubModal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="clubModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–ª—É–±</h2>
<button class="modal-close" onclick="closeClubModal()">‚úï</button>
</div>
<div class="modal-body">
<form id="clubForm" onsubmit="saveClub(event)">
<input type="hidden" id="clubId">
<div class="form-group">
<label class="form-label" id="lblClubName">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
<input type="text" class="form-input" id="clubName" required>
</div>
<div class="form-group">
<label class="form-label" id="lblClubAddress">–ê–¥—Ä–µ—Å</label>
<input type="text" class="form-input" id="clubAddress">
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-cancel" onclick="closeClubModal()" id="btnCancelClub">–û—Ç–º–µ–Ω–∞</button>
<button class="btn btn-save" onclick="document.getElementById('clubForm').requestSubmit()" id="btnSaveClub">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<!-- GROUP MODAL -->
<div class="modal" id="groupModal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="groupModalTitle">–î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</h2>
<button class="modal-close" onclick="closeGroupModal()">‚úï</button>
</div>
<div class="modal-body">
<form id="groupForm" onsubmit="saveGroup(event)">
<input type="hidden" id="groupId">
<div class="form-group">
<label class="form-label" id="lblGroupName">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
<input type="text" class="form-input" id="groupName" required>
</div>
<div class="form-group">
<label class="form-label" id="lblGroupClub">–ö–ª—É–± *</label>
<select class="form-select" id="groupClubId" required>
<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª—É–±</option>
</select>
</div>
<div class="form-group">
<label class="form-label" id="lblSchedule">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</label>
<div class="schedule-editor" id="scheduleEditor">
<button type="button" class="btn btn-add" onclick="addScheduleDay()" id="btnAddSchedule">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å</button>
<div id="scheduleDays"></div>
</div>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-cancel" onclick="closeGroupModal()" id="btnCancelGroup">–û—Ç–º–µ–Ω–∞</button>
<button class="btn btn-save" onclick="document.getElementById('groupForm').requestSubmit()" id="btnSaveGroup">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<!-- TRAINER MODAL -->
<div class="modal" id="trainerModal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="trainerModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞</h2>
<button class="modal-close" onclick="closeTrainerModal()">‚úï</button>
</div>
<div class="modal-body">
<form id="trainerForm" onsubmit="saveTrainer(event)">
<input type="hidden" id="trainerId">
<div class="form-group">
<label class="form-label" id="lblTrainerEmail">Email *</label>
<input type="email" class="form-input" id="trainerEmail" required>
</div>
<div class="form-group">
<label class="form-label" id="lblTrainerPassword">–ü–∞—Ä–æ–ª—å *</label>
<input type="password" class="form-input" id="trainerPassword" required>
</div>
<div class="form-group">
<label class="form-label" id="lblTrainerFirstName">–ò–º—è *</label>
<input type="text" class="form-input" id="trainerFirstName" required>
</div>
<div class="form-group">
<label class="form-label" id="lblTrainerLastName">–§–∞–º–∏–ª–∏—è *</label>
<input type="text" class="form-input" id="trainerLastName" required>
</div>
<div class="form-group">
<label class="form-label" id="lblTrainerPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
<input type="tel" class="form-input" id="trainerPhone">
</div>
<div class="form-group">
<label class="form-label" id="lblTrainerAge">–í–æ–∑—Ä–∞—Å—Ç</label>
<input type="number" class="form-input" id="trainerAge" min="18" max="100">
</div>
<div class="form-group">
<label class="form-label" id="lblTrainerQualification">–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è</label>
<input type="text" class="form-input" id="trainerQualification">
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-cancel" onclick="closeTrainerModal()" id="btnCancelTrainer">–û—Ç–º–µ–Ω–∞</button>
<button class="btn btn-save" onclick="document.getElementById('trainerForm').requestSubmit()" id="btnSaveTrainer">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<script src="i18n.js"></script>
<script>
const API='https://primary-production-4b93e.up.railway.app/webhook/api';
const AUTH_API='https://primary-production-4b93e.up.railway.app/webhook/auth/register';
let token=localStorage.getItem('token');
let user=JSON.parse(localStorage.getItem('user')||'{}');
let clubs=[],groups=[],trainers=[];
let schedule=[];

if(!token||user.role!=='director')window.location.href='/';

function loadUserInfo(){
document.getElementById('userName').textContent=user.first_name?`${user.first_name} ${user.last_name||''}`.trim():user.email;
}

function switchTab(t){
document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
event.target.classList.add('active');
document.getElementById(`tab-${t}`).classList.add('active');
if(t==='clubs'&&clubs.length===0)loadClubs();
if(t==='groups'&&groups.length===0)loadGroups();
if(t==='trainers'&&trainers.length===0)loadTrainers();
}

async function loadClubs(){
try{
document.getElementById('loadingClubs').style.display='block';
document.getElementById('clubsTable').style.display='none';
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'clubs',action:'list',data:{director_id:user.id}})});
let d=await r.json();
clubs=d.merged||d||[];
document.getElementById('loadingClubs').style.display='none';
document.getElementById('clubsTable').style.display='table';
renderClubsTable();
updateClubSelect();
}catch(e){console.error('‚ùå CLUBS ERROR:', e)}
}

function renderClubsTable(){
const t=document.getElementById('clubsTableBody');
t.innerHTML='';
clubs.forEach(c=>{
const r=document.createElement('tr');
r.innerHTML=`<td>${c.name}</td><td>${c.address||'-'}</td><td>${c.groups_count||0}</td><td><div class="table-actions"><button class="btn-icon btn-edit" onclick="editClub(${c.id})">‚úèÔ∏è</button><button class="btn-icon btn-delete" onclick="deleteClub(${c.id})">üóëÔ∏è</button></div></td>`;
t.appendChild(r);
});
}

function updateClubSelect(){
const s=document.getElementById('groupClubId');
s.innerHTML='<option value="">'+t('club')+'</option>';
clubs.forEach(c=>{
const o=document.createElement('option');
o.value=c.id;
o.textContent=c.name;
s.appendChild(o);
});
}

async function loadGroups(){
try{
document.getElementById('loadingGroups').style.display='block';
document.getElementById('groupsTable').style.display='none';
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'groups',action:'list'})});
let d=await r.json();
groups=d.merged||d||[];
document.getElementById('loadingGroups').style.display='none';
document.getElementById('groupsTable').style.display='table';
renderGroupsTable();
}catch(e){console.error(e)}
}

function renderGroupsTable(){
const t=document.getElementById('groupsTableBody');
t.innerHTML='';
groups.forEach(g=>{
const r=document.createElement('tr');
r.innerHTML=`<td><a href="/group-profile.html?id=${g.id}" style="color:var(--p);font-weight:600">${g.name}</a></td><td>${g.club_name||'-'}</td><td>0</td><td>0</td><td><div class="table-actions"><button class="btn-icon btn-edit" onclick="editGroup(${g.id})">‚úèÔ∏è</button><button class="btn-icon btn-delete" onclick="deleteGroup(${g.id})">üóëÔ∏è</button></div></td>`;
t.appendChild(r);
});
}

async function loadTrainers(){
try{
document.getElementById('loadingTrainers').style.display='block';
document.getElementById('trainersTable').style.display='none';
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'users',action:'list',data:{role:'trainer'}})});
let d=await r.json();
trainers=d.merged||d||[];
document.getElementById('loadingTrainers').style.display='none';
document.getElementById('trainersTable').style.display='table';
renderTrainersTable();
}catch(e){console.error(e)}
}

function renderTrainersTable(){
const t=document.getElementById('trainersTableBody');
t.innerHTML='';
trainers.forEach(tr=>{
const r=document.createElement('tr');
r.innerHTML=`<td><a href="/trainer-profile.html?id=${tr.id}" style="color:var(--p);font-weight:600">${tr.first_name||''} ${tr.last_name||''}</a></td><td>${tr.email}</td><td>0</td><td><div class="table-actions"><button class="btn-icon btn-edit" onclick="editTrainer(${tr.id})">‚úèÔ∏è</button><button class="btn-icon btn-delete" onclick="deleteTrainer(${tr.id})">üóëÔ∏è</button></div></td>`;
t.appendChild(r);
});
}

function addClub(){
document.getElementById('clubModalTitle').textContent=t('addClub');
document.getElementById('clubId').value='';
document.getElementById('clubName').value='';
document.getElementById('clubAddress').value='';
openClubModal();
}

function editClub(id){
const c=clubs.find(x=>x.id===id);
if(!c)return;
document.getElementById('clubModalTitle').textContent=t('edit');
document.getElementById('clubId').value=c.id;
document.getElementById('clubName').value=c.name;
document.getElementById('clubAddress').value=c.address||'';
openClubModal();
}

async function saveClub(e){
e.preventDefault();
const id=document.getElementById('clubId').value,n=document.getElementById('clubName').value.trim(),a=document.getElementById('clubAddress').value.trim();
if(!n){alert(t('error'));return}
const data={name:n,address:a,director_id:user.id};
try{
const action=id?'update':'create';
if(id)data.id=parseInt(id);
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'clubs',action,data})});
const res=await r.json();
if(res.id||res.success){
closeClubModal();
alert(t('saved'));
loadClubs();
}else alert(t('error'));
}catch(err){console.error(err);alert(t('error'))}
}

async function deleteClub(id){
if(!confirm(t('deleteConfirm')))return;
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'clubs',action:'delete',data:{id}})});
const d=await r.json();
if(d.success||d.id){alert(t('deleted'));loadClubs()}
}catch(e){console.error(e);alert(t('error'))}
}

function openClubModal(){document.getElementById('clubModal').classList.add('active')}
function closeClubModal(){document.getElementById('clubModal').classList.remove('active')}

function addGroup(){
schedule=[];
document.getElementById('groupModalTitle').textContent=t('addGroup');
document.getElementById('groupId').value='';
document.getElementById('groupName').value='';
document.getElementById('groupClubId').value='';
document.getElementById('scheduleDays').innerHTML='';
openGroupModal();
}

function editGroup(id){
const g=groups.find(x=>x.id===id);
if(!g)return;
schedule=g.schedule?JSON.parse(g.schedule):[];
document.getElementById('groupModalTitle').textContent=t('edit');
document.getElementById('groupId').value=g.id;
document.getElementById('groupName').value=g.name;
document.getElementById('groupClubId').value=g.club_id||'';
renderSchedule();
openGroupModal();
}

function addScheduleDay(){
schedule.push({day:'',time_start:'',time_end:''});
renderSchedule();
}

function renderSchedule(){
const c=document.getElementById('scheduleDays');
c.innerHTML='';
schedule.forEach((s,i)=>{
const d=document.createElement('div');
d.className='schedule-day';
d.innerHTML=`
<div class="schedule-day-header">
<select onchange="updateSchedule(${i},'day',this.value)" style="padding:.5rem">
<option value="">–î–µ–Ω—å</option>
<option value="–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" ${s.day==='–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'?'selected':''}>–ü–Ω</option>
<option value="–í—Ç–æ—Ä–Ω–∏–∫" ${s.day==='–í—Ç–æ—Ä–Ω–∏–∫'?'selected':''}>–í—Ç</option>
<option value="–°—Ä–µ–¥–∞" ${s.day==='–°—Ä–µ–¥–∞'?'selected':''}>–°—Ä</option>
<option value="–ß–µ—Ç–≤–µ—Ä–≥" ${s.day==='–ß–µ—Ç–≤–µ—Ä–≥'?'selected':''}>–ß—Ç</option>
<option value="–ü—è—Ç–Ω–∏—Ü–∞" ${s.day==='–ü—è—Ç–Ω–∏—Ü–∞'?'selected':''}>–ü—Ç</option>
<option value="–°—É–±–±–æ—Ç–∞" ${s.day==='–°—É–±–±–æ—Ç–∞'?'selected':''}>–°–±</option>
<option value="–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ" ${s.day==='–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'?'selected':''}>–í—Å</option>
</select>
<button type="button" onclick="removeScheduleDay(${i})" style="background:#ffebee;border:none;padding:.5rem;border-radius:4px;cursor:pointer">üóëÔ∏è</button>
</div>
<div class="schedule-time">
<input type="time" value="${s.time_start}" onchange="updateSchedule(${i},'time_start',this.value)">
<input type="time" value="${s.time_end}" onchange="updateSchedule(${i},'time_end',this.value)">
</div>
`;
c.appendChild(d);
});
}

function updateSchedule(i,k,v){schedule[i][k]=v}
function removeScheduleDay(i){schedule.splice(i,1);renderSchedule()}

async function saveGroup(e){
e.preventDefault();
const id=document.getElementById('groupId').value,n=document.getElementById('groupName').value.trim(),c=document.getElementById('groupClubId').value;
if(!n||!c){alert(t('error'));return}
const data={name:n,club_id:parseInt(c),schedule:JSON.stringify(schedule)};
try{
const action=id?'update':'create';
if(id)data.id=parseInt(id);
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'groups',action,data})});
const res=await r.json();
if(res.id||res.success){closeGroupModal();alert(t('saved'));loadGroups()}
else alert(t('error'));
}catch(err){console.error(err);alert(t('error'))}
}

async function deleteGroup(id){
if(!confirm(t('deleteConfirm')))return;
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'groups',action:'delete',data:{id}})});
const d=await r.json();
if(d.success||d.id){alert(t('deleted'));loadGroups()}
}catch(e){console.error(e);alert(t('error'))}
}

function openGroupModal(){document.getElementById('groupModal').classList.add('active')}
function closeGroupModal(){document.getElementById('groupModal').classList.remove('active')}

function addTrainer(){
document.getElementById('trainerModalTitle').textContent=t('addTrainer');
document.getElementById('trainerId').value='';
document.getElementById('trainerForm').reset();
openTrainerModal();
}

async function saveTrainer(e){
e.preventDefault();
const id=document.getElementById('trainerId').value,
email=document.getElementById('trainerEmail').value.trim(),
password=document.getElementById('trainerPassword').value,
first_name=document.getElementById('trainerFirstName').value.trim(),
last_name=document.getElementById('trainerLastName').value.trim(),
phone=document.getElementById('trainerPhone').value.trim(),
age=document.getElementById('trainerAge').value,
qualification=document.getElementById('trainerQualification').value.trim();

if(!email||!password||!first_name||!last_name){alert(t('error'));return}

const data={email,password,first_name,last_name,phone,age:age?parseInt(age):null,qualification,role:'trainer'};
try{
const r=await fetch(AUTH_API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'register',...data})});
const res=await r.json();
if(res.success||res.token){closeTrainerModal();alert(t('created'));loadTrainers()}
else alert(t('error')+': '+(res.error||''));
}catch(err){console.error(err);alert(t('networkError'))}
}

async function deleteTrainer(id){
if(!confirm(t('deleteConfirm')))return;
try{
const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,resource:'users',action:'delete',data:{id}})});
const d=await r.json();
if(d.success||d.id){alert(t('deleted'));loadTrainers()}
}catch(e){console.error(e);alert(t('error'))}
}

function openTrainerModal(){document.getElementById('trainerModal').classList.add('active')}
function closeTrainerModal(){document.getElementById('trainerModal').classList.remove('active')}

function logout(){
localStorage.clear();
window.location.href='/';
}

function applyTranslations(){
document.getElementById('btnLogout').textContent=t('logout');
document.getElementById('tabClubs').innerHTML='üè¢ '+t('clubs');
document.getElementById('tabGroups').innerHTML='üë• '+t('groups');
document.getElementById('tabTrainers').innerHTML='üë®‚Äçüè´ '+t('trainers');
document.getElementById('titleClubs').textContent=t('clubs');
document.getElementById('titleGroups').textContent=t('groups');
document.getElementById('titleTrainers').textContent=t('trainers');
document.getElementById('btnAddClub').innerHTML='‚ûï '+t('add');
document.getElementById('btnAddGroup').innerHTML='‚ûï '+t('add');
document.getElementById('btnAddTrainer').innerHTML='‚ûï '+t('add');
document.getElementById('thClubName').textContent=t('name');
document.getElementById('thClubAddress').textContent=t('address');
document.getElementById('thActions').textContent=t('actions');
}

loadUserInfo();
initLangSelector();
applyTranslations();
loadClubs();
</script>
</body>
</html>
